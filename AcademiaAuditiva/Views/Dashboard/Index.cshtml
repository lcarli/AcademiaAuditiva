@{
    ViewBag.Title = "Dashboard";
}

<div class="container mt-5">
    <h2 class="text-center mb-4">@Localizer["Dashboard.Title"]</h2>

    <div class="row text-center mb-4">
        <div class="col-12 col-md-4">
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h6>@Localizer["Dashboard.TotalExercises"]</h6>
                    <h3 id="totalExercises">@ViewBag.TotalExercises</h3>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h6>@Localizer["Dashboard.BestScore"]</h6>
                    <h3 id="bestScore">@ViewBag.BestScore</h3>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h6>@Localizer["Dashboard.TotalTime"]</h6>
                    <h3 id="totalTime">@ViewBag.TotalTime min</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Radar + Acertos por Categoria lado a lado -->
    <div class="row">
        <div class="col-12 col-md-6 mb-4">
            <h5 class="text-center">@Localizer["Dashboard.RadarTitle"]</h5>
            <canvas id="competencyRadarChart" height="200"></canvas>
        </div>
        <div class="col-12 col-md-6 mb-4">
            <h5 class="text-center">@Localizer["Dashboard.CategoryAccuracyTitle"]</h5>
            <canvas id="accuracyBarChart" height="200"></canvas>
        </div>
    </div>

    <!-- Linha do Tempo -->
    <div class="mb-5">
        <h5 class="text-center">@Localizer["Dashboard.TimelineTitle"]</h5>
        <canvas id="learningTimelineChart" height="100"></canvas>
    </div>

    <!-- Evolução por Exercício + Dificuldade -->
    <div class="row">
        <div class="col-12 col-md-6 mb-4">
            <h5 class="text-center">@Localizer["Dashboard.ExerciseImprovementTitle"]</h5>
            <canvas id="improvementLineChart" height="200"></canvas>
        </div>
        <div class="col-12 col-md-6 mb-4">
            <h5 class="text-center">@Localizer["Dashboard.DifficultyTitle"]</h5>
            <canvas id="difficultyBarChart" height="200"></canvas>
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Dados simulados (substituir por ViewBag, API etc.)
            const labels = ["Notas", "Intervalos", "Acordes", "Escalas", "Função"];
            const radarData = [80, 65, 90, 70, 60];
            const accuracyData = [78, 55, 92, 63, 70];
            const timelineData = [3, 5, 4, 2, 6, 5, 7]; // últimos 7 dias
            const improvementData = [40, 55, 68, 75, 82]; // evolução
            const difficultyData = [22, 34, 18, 40, 29];

            fetch('/Dashboard/GetUserProgress')
                .then(res => res.json())
                .then(data => {
                    const radar = data.radar;

                    // Ordem pedagógica (você pode ajustar conforme preferir)
                    const orderedTypes = [
                        "NoteRecognition",
                        "IntervalRecognition",
                        "ChordRecognition",
                        "FunctionRecognition",
                        "ScaleRecognition"
                    ];

                    const labels = orderedTypes.map(type => {
                        switch (type) {
                            case "NoteRecognition": return '@Localizer["ExerciseType.NoteRecognition"]';
                            case "IntervalRecognition": return '@Localizer["ExerciseType.IntervalRecognition"]';
                            case "ChordRecognition": return '@Localizer["ExerciseType.ChordRecognition"]';
                            case "FunctionRecognition": return '@Localizer["ExerciseType.FunctionRecognition"]';
                            case "ScaleRecognition": return '@Localizer["ExerciseType.ScaleRecognition"]';
                            default: return type;
                        }
                    });

                    const values = orderedTypes.map(type => radar[type] || 0);

                    new Chart(document.getElementById("competencyRadarChart"), {
                        type: 'radar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '@Localizer["Dashboard.SkillRadarLabel"]',
                                data: values,
                                fill: true,
                                backgroundColor: 'rgba(75,192,192,0.2)',
                                borderColor: 'rgba(75,192,192,1)',
                                pointBackgroundColor: 'rgba(75,192,192,1)'
                            }]
                        },
                        options: {
                            scales: {
                                r: {
                                    suggestedMin: 0,
                                    suggestedMax: 100
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error("Erro ao carregar dados do radar:", error);
                });


            new Chart("accuracyBarChart", {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: '@Localizer["Dashboard.Accuracy"]',
                        data: accuracyData,
                        backgroundColor: 'rgba(54,162,235,0.7)'
                    }]
                },
                options: { scales: { y: { max: 100, beginAtZero: true } } }
            });

            new Chart("learningTimelineChart", {
                type: 'line',
                data: {
                    labels: ["Seg", "Ter", "Qua", "Qui", "Sex", "Sáb", "Dom"],
                    datasets: [{
                        label: '@Localizer["Dashboard.TimelineLabel"]',
                        data: timelineData,
                        borderColor: 'rgba(255,99,132,1)',
                        tension: 0.3,
                        fill: false
                    }]
                }
            });

            new Chart("improvementLineChart", {
                type: 'line',
                data: {
                    labels: ["Notas", "Acordes", "Escalas", "Intervalos", "Função"],
                    datasets: [{
                        label: '@Localizer["Dashboard.ImprovementLabel"]',
                        data: improvementData,
                        borderColor: 'rgba(153,102,255,1)',
                        tension: 0.3,
                        fill: false
                    }]
                }
            });

            new Chart("difficultyBarChart", {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: '@Localizer["Dashboard.DifficultyLabel"]',
                        data: difficultyData,
                        backgroundColor: 'rgba(255,159,64,0.7)'
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });

        });
    </script>
}